<!doctype html>
<html lang="ar">
<head>
    <meta charset="utf-8">
    <title>IVASMS Fixed Bot</title>
    <style>
        body{background:#0b0f19;color:#fff;font-family:sans-serif;text-align:center;padding:20px}
        .status{padding:15px;border-radius:10px;margin:10px;background:#161b22;border:1px solid #30363d}
        #log{text-align:left;max-height:300px;overflow:auto;background:#000;padding:10px;font-size:12px}
        .green{color:#238636} .red{color:#da3633}
    </style>
</head>
<body>
    <h2>IVASMS Monitor 2026</h2>
    <div class="status">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="st">Ready</span></div>
    <button onclick="start()" style="padding:10px 20px;background:#238636;color:#fff;border:0;border-radius:5px">Start Bot</button>
    <div id="log"></div>

<script>
const TELE_TOKEN = '8109361019:AAFnrD44Yek8qlvBvWvGDLWBWtpOCAOp8yc';
const CHAT_ID = '-1003005165528';
let seen = new Set();

async function send(msg) {
    await fetch(`https://api.telegram.org/bot${TELE_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`);
}

async function check() {
    document.getElementById('st').innerHTML = "Scanning...";
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹
    const url = "https://api.allorigins.win/get?url=" + encodeURIComponent("https://ivasms.com/portal");
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        const html = data.contents;
        
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        const rows = doc.querySelectorAll("tr");

        rows.forEach(row => {
            const cells = row.querySelectorAll("td");
            if (cells.length > 3) {
                const phone = cells[0].innerText.trim();
                const service = cells[1].innerText.trim();
                const code = cells[cells.length - 1].innerText.trim();
                
                if (code && code.length > 1) {
                    const id = phone + code;
                    if (!seen.has(id)) {
                        seen.add(id);
                        send(`âœ… ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯!\nØ§Ù„Ø®Ø¯Ù…Ø©: ${service}\nØ§Ù„Ø±Ù‚Ù…: ${phone}\nØ§Ù„ÙƒÙˆØ¯: ${code}`);
                        const div = document.createElement('div');
                        div.innerHTML = `<span class="green">Sent: ${phone} - ${code}</span>`;
                        document.getElementById('log').prepend(div);
                    }
                }
            }
        });
        document.getElementById('st').innerHTML = "Waiting for new codes...";
    } catch (e) {
        document.getElementById('st').innerHTML = "<span class='red'>Connection Error - Retrying...</span>";
    }
}

function start() {
    setInterval(check, 10000);
    check();
}
</script>
</body>
</html>
        
        let foundNew = false;
        rows.forEach(row => {
          const cells = row.querySelectorAll('td');
          if (cells.length >= 2) {
            const phone = cells[0].innerText.trim();
            const service = cells[1].innerText.trim();
            const code = cells[cells.length-1].innerText.trim();
            
            if (phone && code && code.length > 1) {
              const id = phone + code;
              if (!sentIds.has(id)) {
                sentIds.add(id);
                sendTelegram(phone, code, service);
                log(`âœ… Sent: ${phone} - ${code} (${service})`);
                foundNew = true;
              }
            }
          }
        });
        if(!foundNew) document.getElementById('statusText').textContent = 'No new codes';
      } catch (e) {
        log("âŒ Error fetching data - Retrying...", true);
      }
      setTimeout(scan, 10000); // ÙŠÙØ­Øµ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
    }

    document.getElementById('startBtn').onclick = () => {
      if(!running) { running = true; log("ðŸš€ Monitor Started"); scan(); }
    };
    document.getElementById('stopBtn').onclick = () => {
      running = false; log("ðŸ›‘ Monitor Stopped");
      document.getElementById('statusText').textContent = 'Stopped';
    };
  })();
  </script>
</body>
</html>
